<header class="header">
  <div class="wraper-logo">
    <div class="logo">Online Exam Portal</div>
    <nav class="breadcrumb">
      <span>‚ñ∫</span>
      <span>T·∫°o k√¨ thi v∆°ÃÅi file</span>
    </nav>
  </div>
  <div class="return-button">
    <button (click)="goBack()">Quay laÃ£i</button>
  </div>
</header>

<app-loading *ngIf="loading" text="üåüCreating exam..."></app-loading>

<div class="container">
  <!-- Left content -->
  <div class="left-container">
    <div class="upload-file-container">
      <button (click)="uploadFile()" class="upload-button">
        üìÇ T·∫£i l√™n file
      </button>
      <input
        #fileInput
        (change)="onFileSelected($event)"
        accept=".pdf,.doc,.docx"
        hidden
        id="fileInput"
        type="file"
      />
    </div>

    <!-- Ch·ªâ hi·ªÉn th·ªã PDF n·∫øu c√≥ file PDF -->
    <div *ngIf="selectedFileUrl" class="pdf-preview-container">
      <iframe [src]="selectedFileUrl"></iframe>
    </div>

    <!-- Ch·ªâ hi·ªÉn th·ªã Word n·∫øu kh√¥ng c√≥ PDF -->
    <div
      #wordContainer
      *ngIf="!selectedFileUrl"
      class="word-preview-container"
    ></div>
  </div>

  <!-- Right content -->
  <div class="right-container">
    <div class="tab-header">
      <button
        (click)="setActiveTab('dapan')"
        [class.active]="activeTab === 'dapan'"
        class="tab-button"
      >
        ƒê√°p √°n
      </button>
      <button
        (click)="setActiveTab('thongtin')"
        [class.active]="activeTab === 'thongtin'"
        class="tab-button"
      >
        Th√¥ng tin b√†i thi
      </button>
    </div>
    <div class="tab-content">
      <!-- ƒê√°p √°n -->
      <div *ngIf="activeTab === 'dapan'" class="tab-pane">
        <div class="score-summary">
          <div class="score-item-wrappper">
            <div class="score-item">
              <label for="totalQuestions">S·ªë c√¢u</label>
              <input
                (change)="onTotalQuestionsChange()"
                [(ngModel)]="totalQuestions"
                id="totalQuestions"
                type="number"
              />
            </div>
            <div class="score-item">
              <label for="totalScore">T·ªïng ƒëi·ªÉm</label>
              <input [(ngModel)]="totalScore" id="totalScore" type="number"/>
            </div>
          </div>
          <button (click)="openQuickInput()" class="quick-input">
            Nh·∫≠p nhanh
          </button>
        </div>

        <!-- N·ªÅn t·ªëi khi modal m·ªü -->
        <div
          (click)="isQuickInputOpen = false"
          *ngIf="isQuickInputOpen"
          class="modal-overlay"
        ></div>

        <!-- Modal nh·∫≠p nhanh -->
        <div *ngIf="isQuickInputOpen" class="quick-input-modal">
          <div class="modal-content">
            <h3 class="modal-title">Nh·∫≠p nhanh</h3>
            <p class="modal-description">
              Chu·ªói ƒë√°p √°n vi·∫øt li·ªÅn kh√¥ng d·∫•u (vd: ACDABCAD). M·ªói k√Ω t·ª± l√† 1
              ƒë√°p √°n!
            </p>

            <textarea
              [(ngModel)]="quickInputText"
              [attr.maxlength]="totalQuestions"
              class="quick-input-area"
              placeholder="Nh·∫≠p ƒë√°p √°n t·∫°i ƒë√¢y..."
            ></textarea>
            <p *ngIf="errorMessage" class="error-message">{{ errorMessage }}</p>
            <p class="answer-count">
              B·∫°n s·∫Ω t·∫°o ra {{ quickInputText.length }} ƒë√°p √°n
            </p>

            <div class="modal-actions">
              <button (click)="isQuickInputOpen = false" class="cancel-btn">
                H·ªßy
              </button>
              <button (click)="processQuickInput()" class="confirm-btn">
                X√°c nh·∫≠n
              </button>
            </div>
          </div>
        </div>

        <div class="question-list">
          <div
            *ngFor="let i of getQuestions(); let index = index"
            class="question-item"
          >
            <label class="question-title">C√¢u {{ i + 1 }}</label>

            <div class="input-group">
              <span class="input-label">ƒê√°p √°n</span>
              <select [(ngModel)]="answers[i + 1]" class="answer-select">
                <option *ngFor="let option of answerOptions" [value]="option">
                  {{ option }}
                </option>
              </select>
            </div>

            <div class="input-group">
              <span class="input-label">ƒêi·ªÉm</span>
              <input
                [value]="getQuestionScore()"
                class="score-input"
                disabled
                type="text"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Th√¥ng tin k·ª≥ thi -->
      <div *ngIf="activeTab === 'thongtin'" class="tab-pane">
        <form (ngSubmit)="onSubmit()" [formGroup]="examForm">
          <h2 class="exam-info">Th√¥ng tin b√†i thi</h2>

          <div class="row-wrapper">
            <!-- Input t√™n b√†i thi -->
            <div class="input-wrapper">
              <label for="exam_name">T√™n ƒë√™ÃÄ thi</label>
              <input formControlName="exam_name" id="exam_name"/>
              <div *ngIf="examForm.get('exam_name')?.invalid && examForm.get('exam_name')?.touched" class="error">
                T√™n ƒë√™ÃÄ kh√¥ng ƒë∆∞∆°Ã£c ƒë√™Ãâ tr√¥ÃÅng.
              </div>
            </div>

            <!-- Select th·ªùi gian l√†m b√†i -->
            <div class="input-wrapper">
              <label for="exam_duration">Th·ªùi gian l√†m b√†i:</label>
              <select formControlName="exam_duration" id="exam_duration">
                <option value="15">15 ph√∫t</option>
                <option value="30">30 ph√∫t</option>
                <option value="60">60 ph√∫t</option>
                <option value="90">90 ph√∫t</option>
                <option value="120">120 ph√∫t</option>
              </select>
              <div
                *ngIf="examForm.get('exam_duration')?.invalid && examForm.get('exam_duration')?.touched"
                class="error"
              >
                Vui l√≤ng ch·ªçn th·ªùi gian l√†m b√†i.
              </div>
            </div>
          </div>
          <div class="row-wrapper">
            <div class="input-wrapper">
              <label for="exam_description">L∆∞u yÃÅ</label>
              <input formControlName="exam_description" id="exam_description">
            </div>

            <div class="input-wrapper">
              <label for="exam_subject">M√¥n thi</label>
              <input formControlName="exam_subject" id="exam_subject">
              <div *ngIf="examForm.get('exam_subject')?.invalid && examForm.get('exam_subject')?.touched" class="error">
                T√™n m√¥n hoÃ£c kh√¥ng ƒë∆∞∆°Ã£c ƒë√™Ãâ tr√¥ÃÅng.
              </div>
            </div>
          </div>

          <div class="row-wrapper">
            <div class="input-wrapper">
              <label for="exam_start_date">Th·ªùi gian b·∫Øt ƒë·∫ßu:</label>
              <input formControlName="exam_start_date" id="exam_start_date" type="datetime-local"/>
              <div
                *ngIf="examForm.get('exam_start_date')?.invalid && examForm.get('exam_start_date')?.touched"
                class="error">
                Vui l√≤ng ch·ªçn th·ªùi gian b·∫Øt ƒë·∫ßu.
              </div>
            </div>

            <div class="input-wrapper">
              <label for="exam_end_date">Th·ªùi gian k·∫øt th√∫c:</label>
              <input formControlName="exam_end_date" id="exam_end_date" type="datetime-local"/>
              <div
                *ngIf="examForm.get('exam_end_date')?.invalid && examForm.get('exam_end_date')?.touched"
                class="error">
                Vui l√≤ng ch·ªçn th·ªùi gian k·∫øt th√∫c.
              </div>
            </div>
          </div>


          <button [disabled]="examForm.invalid" type="submit">T·∫°o k·ª≥ thi</button>
        </form>
      </div>
    </div>
  </div>
</div>
<div *ngIf="showWarningModal" class="warning-modal">
  <div class="warning-modal-content">
    <h3>C·∫£nh b√°o</h3>

    <div class="warning-message">
      <p>C√≥ {{ missingQuestions.length }} c√¢u h·ªèi ch∆∞a ƒë∆∞·ª£c nh·∫≠p ƒë√°p √°n:</p>
      <div class="missing-questions">
        <span *ngFor="let question of missingQuestions" class="missing-question-tag">
          C√¢u {{ question }}
        </span>
      </div>
    </div>

    <p class="question-text">B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c n·ªôp b√†i thi n√†y?</p>

    <div class="modal-buttons">
      <button (click)="closeWarningModal()" class="cancel-btn">Quay l·∫°i nh·∫≠p ƒë√°p √°n</button>
      <button (click)="continueSubmit()" class="continue-btn">Ti·∫øp t·ª•c n·ªôp b√†i</button>
    </div>
  </div>
</div>

